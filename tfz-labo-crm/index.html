<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TFZ Labo CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <!-- Struttura principale per versione Vanilla JS -->
    <div class="min-h-screen bg-gray-900 text-white flex">
      <!-- Sidebar -->
      <div class="w-64 bg-gray-800 shadow-lg">
        <div class="p-6">
          <h1 class="text-2xl font-bold text-indigo-400">TFZ Labo CRM</h1>
          <p class="text-gray-400 text-sm mt-1">IPTV Management System</p>
        </div>

        <nav class="mt-6">
          <div class="px-3">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Dashboard</p>
            <ul class="space-y-1">
              <li>
                <a href="#" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white transition-colors" data-section="dashboard">
                  <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"></path>
                  </svg>
                  Dashboard
                </a>
              </li>
            </ul>
          </div>

          <div class="px-3 mt-6">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Clienti</p>
            <ul class="space-y-1">
              <li>
                <a href="#" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white transition-colors" data-section="clients-list">
                  <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                  </svg>
                  Lista Clienti
                </a>
              </li>
              <li>
                <a href="#" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white transition-colors" data-section="add-client">
                  <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                  </svg>
                  Aggiungi Cliente
                </a>
              </li>
            </ul>
          </div>

          <div class="px-3 mt-6">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Abbonamenti</p>
            <ul class="space-y-1">
              <li>
                <a href="#" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white transition-colors" data-section="subscriptions">
                  <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  Abbonamenti & Linee
                </a>
              </li>
            </ul>
          </div>

          <div class="px-3 mt-6">
            <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Ordini</p>
            <ul class="space-y-1">
              <li>
                <a href="#" class="nav-link flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-300 hover:bg-gray-700 hover:text-white transition-colors" data-section="orders">
                  <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                  </svg>
                  Chiamata Ordini
                </a>
              </li>
            </ul>
          </div>

          <div class="px-3 mt-6">
        </nav>
      </div>

      <!-- Contenuto principale -->
      <div class="flex-1 flex flex-col">
        <main class="flex-1 p-6 bg-gray-900" id="main-content">
          <!-- Il contenuto verrà caricato dinamicamente qui -->
          <div class="flex items-center justify-center h-full">
            <div class="text-center">
              <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"></div>
              <p class="text-gray-400">Caricamento CRM...</p>
            </div>
          </div>
        </main>
      </div>
    </div>

    <script type="module" src="/src/main-integration.js?v=1.0.1"></script>

    <!-- Modali per gestione CRUD -->
    <!-- Modale Gestione Cliente -->
    <div id="client-modal" class="modal-overlay hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="client-modal-title">Nuovo Cliente</h2>
          <button class="modal-close" onclick="closeClientModal()">&times;</button>
        </div>
        <form id="client-form" class="modal-form">
          <div class="form-group">
            <label for="client-full-name">Nome Completo *</label>
            <input type="text" id="client-full-name" name="full_name" required>
          </div>
          <div class="form-group">
            <label for="client-phone">WhatsApp</label>
            <input type="tel" id="client-phone" name="phone_whatsapp" placeholder="+39 123 456 7890">
          </div>
          <div class="form-group">
            <label for="client-notes">Note</label>
            <textarea id="client-notes" name="notes" rows="3" placeholder="Note aggiuntive..."></textarea>
          </div>
          <div class="form-group">
            <label for="client-status">Stato</label>
            <select id="client-status" name="status">
              <option value="active">Attivo</option>
              <option value="inactive">Inattivo</option>
            </select>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="closeClientModal()">Annulla</button>
            <button type="submit" class="btn-primary">Salva Cliente</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modale Gestione Abbonamento -->
    <div id="subscription-modal" class="modal-overlay hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="subscription-modal-title">Nuovo Abbonamento</h2>
          <button class="modal-close" onclick="closeSubscriptionModal()">&times;</button>
        </div>
        <form id="subscription-form" class="modal-form">
          <div class="form-group">
            <label for="sub-client">Seleziona Cliente *</label>
            <select id="sub-client" name="client_id" required>
              <option value="">Caricamento clienti...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="sub-username">Username IPTV *</label>
            <input type="text" id="sub-username" name="username_iptv" required>
          </div>
          <div class="form-group">
            <label for="sub-password">Password IPTV</label>
            <input type="password" id="sub-password" name="password_iptv">
          </div>
          <div class="form-group">
            <label for="sub-price">Prezzo (€)</label>
            <input type="number" id="sub-price" name="price" step="0.01" min="0">
          </div>
          <div class="form-group">
            <label for="sub-start-date">Data Inizio *</label>
            <input type="date" id="sub-start-date" name="start_date" required>
          </div>
          <div class="form-group">
            <label for="sub-end-date">Data Scadenza *</label>
            <input type="date" id="sub-end-date" name="end_date" required>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="closeSubscriptionModal()">Annulla</button>
            <button type="submit" class="btn-primary">Salva Abbonamento</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modale Gestione Ticket -->
    <div id="ticket-modal" class="modal-overlay hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="ticket-modal-title">Nuovo Ticket</h2>
          <button class="modal-close" onclick="closeTicketModal()">&times;</button>
        </div>
        <form id="ticket-form" class="modal-form">
          <div class="form-group">
            <label for="ticket-client">Seleziona Cliente *</label>
            <select id="ticket-client" name="client_id" required>
              <option value="">Caricamento clienti...</option>
            </select>
          </div>
          <div class="form-group">
            <label for="ticket-subject">Oggetto *</label>
            <input type="text" id="ticket-subject" name="subject" required placeholder="Descrivi brevemente il problema">
          </div>
          <div class="form-group">
            <label for="ticket-priority">Priorità</label>
            <select id="ticket-priority" name="priority">
              <option value="low">Bassa</option>
              <option value="medium" selected>Media</option>
              <option value="high">Alta</option>
              <option value="urgent">Urgente</option>
            </select>
          </div>
          <div class="form-group">
            <label for="ticket-status">Stato</label>
            <select id="ticket-status" name="status">
              <option value="open" selected>Aperto</option>
              <option value="in_progress">In Lavorazione</option>
              <option value="resolved">Risolto</option>
            </select>
          </div>
          <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="closeTicketModal()">Annulla</button>
            <button type="submit" class="btn-primary">Salva Ticket</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modale Nuovo Ordine -->
    <div id="order-modal" class="modal-overlay hidden">
      <div class="modal-content max-w-2xl w-full mx-4">
        <div class="modal-header">
          <h2 id="order-modal-title">Aggiungi Nuovo Cliente</h2>
          <button class="modal-close" onclick="closeOrderModal()">&times;</button>
        </div>
        <form id="order-form" class="modal-form">
          <!-- Dati Cliente -->
          <div class="form-section">
            <h3 class="form-section-title">Dati Cliente</h3>
            <div class="form-group">
              <label for="order-customer-name">Nome Cliente *</label>
              <input type="text" id="order-customer-name" name="customer_name" required placeholder="Mario Rossi">
            </div>
            <div class="form-group">
              <label for="order-customer-contact">WhatsApp/Telegram</label>
              <input type="text" id="order-customer-contact" name="customer_contact" placeholder="+39 333 1234567">
            </div>
          </div>

          <!-- Dettagli Abbonamento -->
          <div class="form-section">
            <h3 class="form-section-title">Dettagli Abbonamento</h3>
            <div class="form-group">
              <label for="order-line-name">Nome Linea</label>
              <input type="text" id="order-line-name" name="line_name" placeholder="Principale">
            </div>
            <div class="form-group">
              <label for="order-plan-duration">Durata Piano</label>
              <select id="order-plan-duration" name="plan_duration" onchange="calculateEndDate()">
                <option value="1">1 Mese</option>
                <option value="3">3 Mesi</option>
                <option value="6">6 Mesi</option>
                <option value="12">12 Mesi</option>
              </select>
            </div>
            <div class="form-group">
              <label for="order-device-type">Tipo Dispositivo</label>
              <select id="order-device-type" name="device_type">
                <option value="smart_tv">Smart TV</option>
                <option value="android_box">Android Box</option>
                <option value="fire_tv">Fire TV</option>
                <option value="altro">Altro</option>
              </select>
            </div>
            <div class="form-group">
              <label for="order-price">Prezzo (€)</label>
              <input type="number" id="order-price" name="price" step="0.01" min="0" placeholder="49.99">
            </div>
          </div>

          <!-- Date -->
          <div class="form-section">
            <h3 class="form-section-title">Date</h3>
            <div class="form-group">
              <label for="order-start-date">Data Inizio</label>
              <input type="date" id="order-start-date" name="start_date" onchange="calculateEndDate()">
            </div>
            <div class="form-group">
              <label for="order-end-date">Data Scadenza (Calcolata)</label>
              <input type="date" id="order-end-date" name="end_date" readonly>
              <small class="text-gray-400">Calcolata automaticamente in base alla durata</small>
            </div>
          </div>

          <!-- Dati Tecnici -->
          <div class="form-section">
            <h3 class="form-section-title">Dati Tecnici</h3>
            <div class="form-group">
              <label for="order-mac-address">MAC Address</label>
              <input type="text" id="order-mac-address" name="mac_address" placeholder="00:1A:2B:3C:4D:5E">
            </div>
            <div class="form-group">
              <label for="order-m3u-link">Link M3U</label>
              <input type="url" id="order-m3u-link" name="m3u_link" placeholder="http://provider.com/get.php?...">
            </div>
            <div class="form-group">
              <label for="order-password">Password</label>
              <input type="password" id="order-password" name="password" placeholder="Password cliente">
            </div>
            <div class="form-group">
              <label for="order-notes">Note</label>
              <textarea id="order-notes" name="notes" rows="3" placeholder="Note aggiuntive..."></textarea>
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" onclick="closeOrderModal()">Annulla</button>
            <button type="submit" class="btn-primary">Salva Cliente</button>
          </div>
        </form>
      </div>
    </div>

    <!-- CSS per i modali -->
    <style>
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .modal-overlay:not(.hidden) {
        opacity: 1;
      }

      .modal-content {
        background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        border-radius: 12px;
        padding: 0;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transform: scale(0.9);
        transition: transform 0.3s ease;
      }

      .modal-overlay:not(.hidden) .modal-content {
        transform: scale(1);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .modal-header h2 {
        margin: 0;
        color: #f9fafb;
        font-size: 1.5rem;
        font-weight: 600;
      }

      .modal-close {
        background: none;
        border: none;
        color: #9ca3af;
        font-size: 24px;
        cursor: pointer;
        padding: 0;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        transition: all 0.2s ease;
      }

      .modal-close:hover {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
      }

      .modal-form {
        padding: 24px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 6px;
        color: #f9fafb;
        font-weight: 500;
        font-size: 14px;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 6px;
        background: rgba(255, 255, 255, 0.05);
        color: #f9fafb;
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .form-group textarea {
        resize: vertical;
        min-height: 80px;
      }

      .modal-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 24px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
      }

      .btn-primary {
        background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: #f9fafb;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .hidden {
        display: none !important;
      }

      /* Stili per le sezioni del form ordini */
      .form-section {
        margin-bottom: 24px;
        padding: 16px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .form-section-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #f9fafb;
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
    </style>
  </body>
</html>